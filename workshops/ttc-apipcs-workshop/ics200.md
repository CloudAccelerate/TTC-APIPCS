<center>![](https://cloudaccelerate.github.io/TTC-CommonContent/images/ttc-logo.png)</center>

# Lab 200 - API Platfrom Cloud Service

## Objectives

- Using API Platform Cloud Service (APIPCS) to create an API, configure endpoint and credentials to connect to ICS HelloWorld API.

## Required Artifacts

- The following lab and an Oracle Public Cloud account that will be supplied by your instructor.
- Deployment of ICS REST service in Lab 100

## Introduction

This is the second of several labs that are part of the **APIPCS/ICS Development Workshop**. 

In this lab, we will learn how to expose our ICS REST service, created in Lab 100, through the API Platform Cloud Service, enforce policies and share the documentation around our controlled service to developers.

We’ll look at the following:
1.  Creating an API
2.  Adding a Service Request with Service Account to the API
3.  Deploying the API on a Gateway
3.  Testing the API through the Gateway

## Login to your Oracle Cloud account

### Login to APIPCS Home Page

>***NOTE:*** the **User Name** and **Password** values will be given to you by your instructor. See _Lab 100 **1.1.1**: Login to your Oracle Cloud Account_ for more information on how to sign into the APIPCS home page.


![](images/200/image001.png)  

Sign in to the Management Portal as a user with the API Manager role:

![](images/200/image041.png) 

---

## 1. API Platform Cloud - Management Portal
---


### 1.1 APIs

#### 1.1.1 Create an API Proxy

- Now you’ll create a proxy for your API.

- To create an API:
  - From the APIs tab, click Create API.
  - Enter the name of your resource followed by your assigned number (like HelloWorldUserXX) into the API Name field. This makes it easier to identity your API in case multiple people use the same API name.
  - Enter 1 in the Version field.
  - (Optional) Populate the description field in this form as you would like.

![](images/200/image042.png) 

  - Click Create.

![](images/200/image043.png) 

#### 1.1.2 Configure the API Request

- The API request is the endpoint to which requests for your API are sent when it is deployed to a gateway.

- To configure the API Request:
  - From the APIs page, click the API you created in the previous task.
  - Hover over the API Request policy, and then click Edit.

![](images/200/image044.png)   

>***NOTE:***Note: If the Apply Policy Dialog does not appear, disable any pop-up blockers that are active and try again.

![](images/200/image045.png) 

- On the Apply Policy Dialog, complete these fields:
  -Select HTTPS from the Protocol list. This is the protocol on which the gateway receives requests for this API.
  - Enter name of your resource in lower case, followed by your assigned number to ensure uniqueness (like helloworlduserXX) into the API Endpoint URL field.

![](images/200/image046.png) 

  - Click Apply.

#### 1.1.3 Configure the Service Request

- The service request is the URL at which your backend service receives requests. When a request meets all policy conditions, the gateway routes the request to this URL and calls your service.

- The service request URL can point to any of your service’s resources, not just its base URL. This way you can restrict users to access only a subset of your API’s resources.

- To configure the service request:
  - Hover over the Service Request policy, and then click Edit.

![](images/200/image047.png) 

  - On the Apply Policy Dialog, complete these fields:
    - Paste the mock server value you copied at the end of Lab 100 (which should resemble 
  https://<ICS URL>/integration/flowapi/rest/HELLOWORLD_USER01/v01/helloworld_user01) into the Backend Service URL field.
    - Add the Service Account which stores the credentials to log into Oracle ICS

![](images/200/image048.png) 

    - Click Apply.

![](images/200/image049.png) 

    - Click Save Changes

#### 1.1.4 Deploy API to the API Gateway

After creating the API, adding the API Request and Service Request. In this section you will deploy the API to and API Gateway so that it receives requests at the endpoint you configured and routes successful requests to the service you created with Oracle ICS in Lab 100. 

- To deploy the API:
    - Click the Deployments tab.

![](images/200/image050.png)

  - Click Deploy API. You will see a list of Deployment Gateways available with APIPCS

![](images/200/image051.png)

  - Select the `Production Gateway - NA- Oracle` Gateway.
  - Select Active as the Initial Deployment State.
  - (Optional) Complete the description field in as you like.

![](images/200/image052.png)

  - Click Deploy.
  - Wait for the deployment to complete (the page refreshes automatically). The deployment is complete when your API displays on the Deployed tab.

![](images/200/image053.png)
  

  - Copy the URL that appears in the Load Balancer URL section. This is the endpoint clients use to send requests to your proxy API on the gateway. 

    - The URL should look something like this: http://oc-129-144-152-17.compute.oraclecloud.com:9022/helloworlduser01
  
![](images/200/image054.png)


#### 1.1.5 Test API

To test the `HelloWorld` integration, we will use `Postman` installed during the pre-requisite section. Postman will now call APIPCS which will check the Policies and if successful, send the request to ICS for processing

Click on the `+` menu option to open a new Tab

![](images/200/image055.png)

- On the `New Tab` page, enter the following information 
    - Change the `GET` to `POST`
    - URL : http://oc-129-144-152-17.compute.oraclecloud.com:9022/helloworlduser01

>***NOTE:***Note: the URL is the Load Balancer URL when you deployed the service to API Gateway. Also, we are not adding authentication during this test because APIPCS is responsible for authenticating the request with ICS using Service Account Added when you configured the Service Request in Section 1.1.3

![](images/200/image056.png)

- Select `Headers` tab to add the following headers to the request
    - Content-Type : application\json
    - icsHeader : Value Passed by Postman Through APIPCS

![](images/200/image057.png)

- Select `Body` tab to add the request
    - Select `raw` type
    - Supply the following JSON:

        ```javascript
        {
            "greetings":"user01"
        }
        ```
![](images/200/image058.png)

- Click `Send` to test HelloWorld API

![](images/200/image059.png)

- Check that `icsHeader` is also populated by selecting `Headers`, then scroll to the bottom of the screen

![](images/200/image060.png)

#### 1.1.6 HelloWorld API Analytics

In this section you’ll view the charts available for an API

- Click the Analytics icon. This displays the Analytics landing page with summary information

![](images/200/image061.png)

- Scroll down to view the following charts

  - Request Volume Chart
The request volume chart displays how many requests an API deployed to a gateway received. For a given time, you can configure the chart to display all requests, only successful requests, only rejected requests, or only errored requests.

![](images/200/image062.png)

  - Response Time Chart
The response time chart displays, in milliseconds, the range of round-trip request and response times for a selected API. The ranges, represented by a gray bar, indicate the shortest and longest response times during the indicated time period. The median round-trip time is indicated by a blue bar in the range for a time period. For a given time, you can configure the charts to display the range of round-trip calls, the range of time spent in the API layer, and the range of time spent in the service layer.

![](images/200/image063.png)

  - Payload Size Chart
The Payload Size chart displays the size of the payloads sent with each request. You can filter this chart to display the size of request or response payloads.

![](images/200/image064.png)

  - Requests by Resource Chart
The Requests by Resource chart, at the bottom of the General page, displays the number and distribution of requests to your service’s resources.

![](images/200/image065.png)

## Completion of LAB 200

